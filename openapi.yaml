openapi: 3.0.0
info:
  title: Restaurant Reservation System
  version: 1.1.0
  description: >
    API para la gestión de reservas mediante auto-asignación y administración de capacidad física.
    Soporta límites por área, normalización de capacidad (7->8) y reglas VIP.
servers:
  - url: https://restaurantelaterraza-production.up.railway.app
    description: Servidor de producción
  - url: http://localhost:3000
    description: Servidor Local

paths:
  /health:
    get:
      summary: Estado de salud del servidor
      responses:
        '200':
          description: El servidor está operativo
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: "ok" }
                  timestamp: { type: string, format: date-time }

  /areas:
    get:
      summary: Obtener todas las áreas y su ocupación de mesas
      responses:
        '200':
          description: Lista de áreas con sus límites físicos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Area'

  /areas/{areaId}/tables:
    post:
      summary: Agregar una nueva mesa a un área (Respetando límites)
      parameters:
        - name: areaId
          in: path
          required: true
          schema:
            type: string
            example: "TERRACE"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [capacity]
              properties:
                capacity: { type: integer, example: 4 }
                type: { type: string, enum: [STANDARD, CIRCULAR, VIP_SQUARE], default: "STANDARD" }
      responses:
        '201':
          description: Mesa creada exitosamente
        '409':
          description: Conflicto - Límite de mesas alcanzado para el área
        '404':
          description: Área no encontrada

  /reservations:
    get:
      summary: Listar reservas filtradas
      parameters:
        - name: date
          in: query
          schema: { type: string, format: date }
          description: Filtrar por día (YYYY-MM-DD)
        - name: areaId
          in: query
          schema: { type: string }
          description: Filtrar por área específica
      responses:
        '200':
          description: Lista de reservas encontradas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reservation'
    
    post:
      summary: Crear una reserva (Auto-asignación y Auto-confirmación)
      description: >
        Busca la mesa ideal (redondeando capacidad). 
        Las reservas se crean directamente con estado CONFIRMED.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [partySize, date, startTime, duration, areaId]
              properties:
                partySize: { type: integer, example: 7 }
                date: { type: string, format: date, example: "2026-12-01" }
                startTime: { type: string, example: "19:00" }
                duration: { type: integer, example: 90, enum: [90, 120, 180] }
                areaId: { type: string, example: "TERRACE" }
      responses:
        '201':
          description: Reserva creada y confirmada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '409':
          description: Conflicto - No hay mesas disponibles en ese horario
        '422':
          description: Error de validación (Fecha pasada o capacidad imposible)

  /reservations/{id}/status:
    patch:
      summary: Cambiar estado de una reserva
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status: { type: string, enum: [CONFIRMED, CANCELLED] }
      responses:
        '200':
          description: Estado actualizado
        '404':
          description: Reserva no encontrada

  /seed:
    post:
      summary: Reiniciar y cargar configuración inicial del gerente
      responses:
        '200':
          description: Datos restaurados según el seed.json

components:
  schemas:
    Area:
      type: object
      properties:
        id: { type: string, example: "TERRACE" }
        name: { type: string, example: "Terraza" }
        maxTables: { type: integer, example: 8 }
        currentTableCount: { type: integer, example: 5 }

    Reservation:
      type: object
      properties:
        id: { type: string, example: "res_507f1f" }
        tableId: { type: string, example: "TERRACE-1" }
        partySize: { type: integer, example: 7 }
        date: { type: string, example: "2026-12-01" }
        startTime: { type: string, example: "19:00" }
        endTime: { type: string, example: "20:30" }
        status: { type: string, enum: [CONFIRMED, CANCELLED] }